---
title: Validator - Library - Docs
---

import { Callout } from 'nextra/components';

# Validator

The `OptionValidator` class is a component that can be used to validate option definitions. It can
be instantiated with a set of option _definitions_ and provides a method to perform the validation.

## Option validation

We use the term _validation_ to refer to the "sanity check" of option definitions. It is intended
for use during development only, whereas in production it would impose an unnecessary performance
penalty on your application. Validations behave like assertions: they assert that your program will
work as expected when delivered to end-users.

To validate a set of option definitions, you must call the `validate` method on the validator
instance. This method accepts a `ValidationFlags` argument with the following optional properties:

- `noNamingIssues` -
  whether the validation procedure should skip detection of naming inconsistencies
- `noRecurse` -
  whether the validation procedure should skip recursion into nested commands

It returns a promise that resolves to a `ValidationResult` object with the following properties:

- `warning` -
  A compilation of warning messages that represent non-impeditive issues encountered in the option
  definitions. You may want to print it to see if they are important to your application.

<Callout type="info">
  This method is _asynchronous_, so you must use `await{:ts}` in order to resolve the returned
  promise.
</Callout>

## Validation rules

There are two kinds of validation performed by the validator: those that generate an error and those
that generate a warning. They are listed below.

### Validation errors

The following restrictions will raise an error on any option definition that fails to satisfy it,
with an explanatory message that may include the option's key.

- **Invalid option name** -
  An option name must not contain whitespace or the equals sign `'='{:ts}`, since this character can
  be used as option-parameter separator on the command-line. Any other Unicode character is allowed.
- **Duplicate option name** -
  An option should not have duplicate names, and there cannot be two options with the same name.
- **Invalid cluster letter** -
  A cluster letter must not contain whitespace. Any other Unicode character is allowed.
- **Duplicate cluster letter** -
  An option should not have duplicate cluster letters, and there cannot be two options with the
  same letter.
- **Duplicate choice value** -
  In a single- or array-valued option with [parameter choices], the choices must _not_ contain
  duplicate elements.
- **Invalid parameter count** -
  In a function option with a range [parameter count], the minimum value should be strictly less
  than the maximum, but not less than zero.
- **Option requiring itself** -
  An option must not declare a requirement that references itself.
- **Unknown required option** -
  An option must not declare a requirement that references an _unknown_ option.
- **Invalid required option** -
  An option must not declare a requirement that references either a non-valued option (help and
  version) or an unknown-valued option (function and command) in a requirement.
- **Invalid required value** -
  An option must not declare a requirement that references another option that is either [always
  required] or has a [default value], if the required value is nullish (`null{:ts}` or
  `undefined{:ts}`).
- **Duplicate positional option** -
  Since positional arguments have no name, they must pertain to exactly one option. Hence, there
  cannot be _two_ options with the positional attribute in the same set of option definitions.

<Callout type="info">
 `null{:ts}` values are ignored in option names, while the [positional marker] is included.
</Callout>

The validator does not validate the _satisfiability_ of option requirements, not only because it
cannot evaluate [requirement callbacks] at validation time, but also because [requirement expressions]
can be arbitrarily complex. For example, a simple expression like `req.all({opt:1}, {opt:2}){:ts}`
cannot be satisfied, but is hard to verify in general. This problem is known as [B-SAT], which is
known to be [NP-complete].

### Validation warnings

The following restrictions will produce a warning that is returned by the validation procedure.

- **Too similar names** -
  When two option names are very similar (e.g., if they differ by a single character in a
  five-character name), this may be a development mistake, or worse, it can become a source of
  headaches for end-users. Hence, the validator tries to find names that closely match a given name
  using the same algorithm used by the parser in [name suggestions], just a little stricter.
- **Mixed naming convention** -
  When a [name slot] contains names with different naming conventions (e.g., all-uppercase vs
  all-lowercase, or single-dash vs double-dash), this may be a sign of code review negligence, or
  worse, it can make it hard for end-users to reason about your application. Thus, the validator
  tries to find names within a slot that contain mixed naming patterns.
- **Variadic option with cluster letter** -
  A variadic option that declares [cluster letters] must always be the last option in a cluster
  argument. This includes [command] options, array-valued options and function options with a
  variable [parameter count]. This might not be the intended behavior and if so, you should consider
  alternatives.

## Validator configuration

The validator can be configured via a `ValidatorConfig` object, which can be provided as an
additional parameter to the validator constructor. It contains the same properties as the [message
configuration], as well as the property described below.

### Error phrases

The `phrases` property specifies [custom phrases] to use for error and warning messages. Its
properties are optional and are indexed by the `ValidationError` enumeration, which lists the kinds
of errors and warnings that may be produced by the validator. They are summarized in the table
below:

| Validation error            | Raised when                                                                                                                 | Default phrase                                                                                   | Format specifiers                                                                          |
| --------------------------- | --------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------ |
| `invalidOptionName`         | An option has an invalid name                                                                                               | `'Option #0 has invalid name #1.'{:ts}`                                                          | `#0` = the option's key; `#1` = the invalid name                                           |
| `invalidSelfRequirement`    | An option references itself in a requirement                                                                                | `'Option #0 requires itself.'{:ts}`                                                              | `#0` = the option's key                                                                    |
| `unknownRequiredOption`     | An option references an unknown option in a requirement                                                                     | `'Unknown option #0 in requirement.'{:ts}`                                                       | `#0` = the required option's key                                                           |
| `invalidRequiredOption`     | An option references a non-valued option in a requirement                                                                   | `'Invalid option #0 in requirement.'{:ts}`                                                       | `#0` = the required option's key                                                           |
| `invalidRequiredValue`      | An option uses a nullish value in a requirement referencing an option that is either always required or has a default value | `'Invalid required value for option #0. Option is always required or has a default value.'{:ts}` | `#0` = the required option's key                                                           |
| `duplicateOptionName`       | There are two identical option names                                                                                        | `'Option #0 has duplicate name #1.'{:ts}`                                                        | `#0` = the option's key; `#1` = the duplicate name                                         |
| `duplicatePositionalOption` | There are two or more positional options                                                                                    | `'Duplicate positional option #0: previous was #1.'{:ts}`                                        | `#0` = the duplicate option's key; `#1` = the previous option's key                        |
| `duplicateChoiceValue`      | A choices constraint has a duplicate value                                                                                  | `'Option #0 has duplicate choice #1.'{:ts}`                                                      | `#0` = the option's key; `#1` = the duplicate value                                        |
| `duplicateClusterLetter`    | There are two identical cluster letters                                                                                     | `'Option #0 has duplicate cluster letter #1.'{:ts}`                                              | `#0` = the option's key; `#1` = the duplicate letter                                       |
| `invalidClusterLetter`      | An option has an invalid cluster letter                                                                                     | `'Option #0 has invalid cluster letter #1.'{:ts}`                                                | `#0` = the option's key; `#1` = the invalid letter                                         |
| `tooSimilarOptionNames`     | An option name is too similar to other names                                                                                | `'#0: Option name #1 has too similar names: #2.'{:ts}`                                           | `#0` = the command prefix[^1]; `#1` = the option name; `#2` = the similar names            |
| `mixedNamingConvention`     | A name slot contains names with different naming conventions                                                                | `'#0: Name slot #1 has mixed naming conventions: #2.'{:ts}`                                      | `#0` = the command prefix[^1]; `#1` = the [name slot] index; `#2` = the naming conventions |
| `invalidParamCount`         | A function option has an invalid parameter count                                                                            | `'Option #0 has invalid parameter count #1.'{:ts}`                                               | `#0` = the option's key; `#1` = the parameter count                                        |
| `variadicWithClusterLetter` | A variadic option declares cluster letters                                                                                  | `'Variadic option #0 may only appear as the last option in a cluster.'{:ts}`                     | `#0` = the option's key                                                                    |
| `invalidInlineConstraint`   | A variadic option declares an inline constraint                                                                             | `'Option #0 has invalid inline constraint.'{:ts}`                                                | `#0` = the option's key                                                                    |

<Callout type="info">Phrases are formatted according to [text formatting] rules.</Callout>

[^1]:
    The command prefix is a series of option keys interspersed with periods, denoting the current
    [nested command] in a hierarchical option definition. It starts as the empty string and is
    appended with a nested command's key whenever one is encountered. This prefix also appears in
    other validation errors, prefixing an option's key in the `%o` specifier. Here's an example:
    `cmd1.cmd2.flag`.

[value validation]: #value-validation

{/* options references */}
[command]: options#command-option
[example value]: options#example-value
[positional marker]: options#positional--marker
[parameter choices]: options#parameter-choices
[regular expression]: options#regular-expression
[element count limit]: options#element-count-limit
[default callbacks]: options#default-callback
[positional]: options#positional--marker
[always required]: options#always-required
[required]: options#disable--require-inline
[default value]: options#default-value
[parameter count]: options#parameter-count
[cluster letters]: options#cluster-letters
[truth and falsity]: options#truth--falsity-names
[inline constraint]: options#disable--require-inline
[requirement callbacks]: options#requirement-callback
[requirement expressions]: options#requirement-expression

{/* styles references */}
[text formatting]: styles#text-splitting
[format specifiers]: styles#format-specifiers
[message configuration]: styles#message-configuration

{/* formatter references */}
[name slot]: formatter#name-slots

{/* parser references */}
[name suggestions]: parser#name-suggestions
[inline parameter]: parser#inline-parameters

{/* external references */}
[B-SAT]: https://www.wikiwand.com/en/Boolean_satisfiability_problem
[NP-complete]: https://www.wikiwand.com/en/NP-complete
